<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sessions de Ramassage de DÃ©chets</title>
    <link rel="stylesheet" href="global.css">

    <!-- Leaflet -->
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script
        src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js">
    </script>

</head>

<body>
<div id="header"></div>

<div class="containerp2">
    <div class="title">
        <h1>ğŸŒ Sessions de Ramassage de DÃ©chets</h1>
        <p class="subtitle">Rejoignez-nous pour nettoyer nos plages !</p>
    </div>

    <div class="content">
        <div class="left-section">
            <!-- Section de filtre -->
            <div class="filter-section">
                <h3>ğŸ“… Trier par date</h3>
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterSessions('recent')">
                        â¬†ï¸ Plus rÃ©cent
                    </button>
                    <button class="filter-btn" onclick="filterSessions('ancien')">
                        â¬‡ï¸ Plus ancien
                    </button>
                    <button class="filter-btn" onclick="filterSessions('default')">
                        ğŸ”„ Ordre par dÃ©faut
                    </button>
                </div>
            </div>

            <div class="session-list" id="sessionList"></div>

            <div class="registration-form" id="registrationForm">
                <h2 class="form-title">Formulaire d'inscription</h2>
                <form id="userForm">

                    <div class="form-group">
                        <label for="nom">Nom <span class="required">*</span></label>
                        <input type="text" id="nom" name="nom" required>
                    </div>

                    <div class="form-group">
                        <label for="prenom">PrÃ©nom <span class="required">*</span></label>
                        <input type="text" id="prenom" name="prenom" required>
                    </div>

                    <div class="form-group">
                        <label for="email">Email <span class="required">*</span></label>
                        <input type="email" id="email" name="email" required>
                    </div>

                    <div class="form-group">
                        <label for="telephone">TÃ©lÃ©phone <span class="required">*</span></label>
                        <input type="tel" id="telephone" name="telephone" required>
                    </div>

                    <div class="form-group">
                        <label for="adresse">Adresse <span class="required">*</span></label>
                        <input type="text" id="adresse" name="adresse" required>
                    </div>

                    <div class="form-group">
                        <label for="codePostal">Code postal <span class="required">*</span></label>
                        <input type="text" id="codePostal" name="codePostal" required>
                    </div>

                    <div class="form-group">
                        <label for="duree">DurÃ©e de prÃ©sence <span class="required">*</span></label>
                        <select id="duree" name="duree" required>
                            <option value=""> SÃ©lectionnez </option>
                            <option value="30min">30 minutes</option>
                            <option value="1h">1 heure</option>
                            <option value="1h30">1heures et 30 minutes </option>
                            <option value="2h">2 heures</option>
                            <option value="2h">2 heures et 30 minutes</option>
                            <option value="2h">3 heures</option>
                        </select>
                    </div>

                    <button type="submit" class="btn-primary">
                        Confirmer mon inscription
                    </button>
                </form>
            </div>

            <div class="success-message" id="successMessage">
                <h2>âœ… Inscription confirmÃ©e</h2>
                <p>Merci pour votre engagement en faveur du littoral. Vous recevrez un e-mail de confirmation prochainement avec les informations exactes sur le lieu de rendez-vous.</p>
            </div>
        </div>

        <div class="right-section">
            <div class="map-container">
                <h3 class="map-title">ğŸ“ Carte des Ã©vÃ©nements</h3>
                <div id="map"></div>
            </div>
        </div>
    </div>
</div>

<div id="footer"></div>

<script>
const sessions = [
    { 
        id: 1, 
        titre: "Nettoyage Plage de PlouzanÃ©", 
        date: "Samedi 15 mars 2025",
        dateSort: "2025-03-15",
        horaire: "09h - 12h", 
        plage: "Plage du Petit Minou", 
        lieu: "PlouzanÃ©",
        lat: 48.34173,
        lng: -4.61595
    },
    { 
        id: 2, 
        titre: "Ramassage Plougastel", 
        date: "Dimanche 16 mars 2025",
        dateSort: "2025-03-16",
        horaire: "14h - 17h", 
        plage: "Plage de Porz Don", 
        lieu: "Plougastel",
        lat: 48.35237,
        lng: -4.33236 
    },
    {
        id: 3,
        titre: "Nettoyage Plage de Brest",
        date: "Samedi 22 mars 2025",
        dateSort: "2025-03-22",
        horaire: "10h - 13h",
        plage: "Plage du Moulin Blanc",
        lieu: "Brest",
        lat: 48.39897,
        lng: -4.42625
    },
    {
        id: 4,
        titre: "Ramassage Plage de Saint Anne",
        date: "Dimanche 23 mars 2025",
        dateSort: "2025-03-23",
        horaire: "08h30 - 11h30",
        plage: "Plage de Saint Anne",
        lieu: "Brest",
        lat: 48.36182,
        lng: -4.55220
    }
];

let selectedSessionId = null;
let currentFilter = 'recent';
let displayedSessions = [...sessions];

function filterSessions(filterType) {
    currentFilter = filterType;
    
    // Mettre Ã  jour les boutons actifs
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Trier les sessions selon le filtre
    if (filterType === 'recent') {
        displayedSessions = [...sessions].sort((a, b) => 
            new Date(a.dateSort) - new Date(b.dateSort)
        );
    } else if (filterType === 'ancien') {
        displayedSessions = [...sessions].sort((a, b) => 
            new Date(b.dateSort) - new Date(a.dateSort)
        );
    } else {
        displayedSessions = [...sessions];
    }
    
    renderSessions();
}

function renderSessions() {
    document.getElementById("sessionList").innerHTML = displayedSessions.map(s => `
        <div class="session-item ${selectedSessionId === s.id ? 'selected' : ''}" data-id="${s.id}">
            <div class="session-header">
                <div>
                    <h3 class="session-title">${s.titre}</h3>
                </div>
                <button class="btn-secondary ${selectedSessionId === s.id ? 'selected' : ''}" onclick="selectSession(${s.id})">
                    ${selectedSessionId === s.id ? 'âœ“ SÃ©lectionnÃ©' : 'Je participe'}
                </button>
            </div>
            <div class="session-info">
                <div class="info-row">
                    <span>ğŸ“… ${s.date}</span>
                </div>
                <div class="info-row">
                    <span>ğŸ•’ ${s.horaire}</span>
                </div>
                <div class="info-row">
                    <span>ğŸ–ï¸ ${s.plage}</span>
                </div>
                <div class="info-row">
                    <span>ğŸ“ ${s.lieu}</span>
                </div>
            </div>
        </div>
    `).join("");
}

function selectSession(id) {
    // Si on clique sur la mÃªme session, on la dÃ©sÃ©lectionne
    if (selectedSessionId === id) {
        selectedSessionId = null;
        
        // RÃ©initialiser tous les marqueurs en bleu
        Object.keys(markers).forEach(markerId => {
            markers[markerId].setIcon(defaultIcon);
        });
        
        // Masquer le formulaire et le message de succÃ¨s
        document.getElementById("registrationForm").classList.remove("active");
        document.getElementById("successMessage").classList.remove("active");
        
        // RÃ©afficher les sessions
        renderSessions();
        
        return;
    }
    
    selectedSessionId = id;
    
    // RÃ©initialiser tous les marqueurs en bleu
    Object.keys(markers).forEach(markerId => {
        markers[markerId].setIcon(defaultIcon);
    });
    
    // Mettre le marqueur sÃ©lectionnÃ© en vert
    if (markers[id]) {
        markers[id].setIcon(selectedIcon);
    }
    
    // RÃ©afficher les sessions avec la sÃ©lection mise Ã  jour
    renderSessions();

    // Afficher le formulaire et masquer le message de succÃ¨s
    document.getElementById("registrationForm").classList.add("active");
    document.getElementById("successMessage").classList.remove("active");
    
    // Scroll vers le formulaire
    document.getElementById('registrationForm').scrollIntoView({ 
        behavior: 'smooth', 
        block: 'start' 
    });
}

document.getElementById("userForm").addEventListener("submit", e => {
    e.preventDefault();
    
    // RÃ©cupÃ©rer les donnÃ©es du formulaire
    const formData = {
        sessionId: selectedSessionId,
        nom: document.getElementById('nom').value,
        prenom: document.getElementById('prenom').value,
        email: document.getElementById('email').value,
        telephone: document.getElementById('telephone').value,
        adresse: document.getElementById('adresse').value,
        codePostal: document.getElementById('codePostal').value,
        duree: document.getElementById('duree').value
    };

    // Afficher les donnÃ©es dans la console
    console.log('Inscription enregistrÃ©e:', formData);
    
    // Masquer le formulaire et afficher le message de succÃ¨s
    document.getElementById("registrationForm").classList.remove("active");
    document.getElementById("successMessage").classList.add("active");
    
    // RÃ©initialiser le formulaire
    e.target.reset();
    
    // Scroll vers le message de succÃ¨s
    document.getElementById('successMessage').scrollIntoView({ 
        behavior: 'smooth' 
    });
});

// IcÃ´nes personnalisÃ©es pour les marqueurs
const defaultIcon = L.icon({
    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
});

const selectedIcon = L.icon({
    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
});

const map = L.map("map").setView([48.38, -4.48], 10);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: "Â© OpenStreetMap"
}).addTo(map);

// Stocker les marqueurs pour pouvoir les modifier
const markers = {};

sessions.forEach(session => {
    const marker = L.marker([session.lat, session.lng], { icon: defaultIcon }).addTo(map);
    marker.bindPopup(`<strong>${session.titre}</strong><br>${session.plage}`);
    marker.on("click", () => selectSession(session.id));
    markers[session.id] = marker;
});

// Initialiser la page avec le filtre par dÃ©faut (plus rÃ©cent)
filterSessions('recent');
</script>

<script src="js/layout.js"></script>
</body>
</html>